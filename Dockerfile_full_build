FROM ros:noetic-ros-core

RUN apt-get update -y

# Standard tools
RUN apt-get install -y clang make gcc g++ inetutils-ping net-tools git tmux
RUN DEBIAN_FRONTEND='noninteractive' apt-get install -y libpcl-dev

# 2. Install ROS packages from apt.
RUN apt-get install -y \
    ros-noetic-eigen-conversions \
    ros-noetic-gazebo-ros \
    ros-noetic-grid-map-core \
    ros-noetic-grid-map-ros \
    ros-noetic-joint-state-publisher \
    ros-noetic-move-base \
    ros-noetic-ompl \
    ros-noetic-realsense2-camera \
    ros-noetic-robot-pose-ekf \
    ros-noetic-robot-state-publisher \
    ros-noetic-rosmon \
    ros-noetic-rviz \
    ros-noetic-tf2-tools

COPY ros/scripts /ros/scripts
COPY ros/catkin_ws/.catkin_workspace /ros/catkin_ws/.catkin_workspace
COPY can /can

# Incremental-ish builds to avoid full rebuilds. Keep these in order
# from least to most often changed.
COPY ros/catkin_ws/src/kindr /ros/catkin_ws/src/kindr_ros
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/kindr_ros /ros/catkin_ws/src/kindr_ros
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/message_logger /ros/catkin_ws/src/message_logger
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/realsense-ros /ros/catkin_ws/src/realsense-ros
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/se2_grid_map_generator_msgs /ros/catkin_ws/src/se2_grid_map_generator_msgs
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/se2_grid_map_generator /ros/catkin_ws/src/se2_grid_map_generator
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/se2_navigation_msgs /ros/catkin_ws/src/se2_navigation_msgs
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/se2_planning /ros/catkin_ws/src/se2_planning
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/se2_planning_ros /ros/catkin_ws/src/se2_planning_ros
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

#COPY ros/catkin_ws/src/david_tui /ros/catkin_ws/src/david_tui
#RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make


COPY ros/catkin_ws/src/motor_bridge /ros/catkin_ws/src/motor_bridge
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

COPY ros/catkin_ws/src/pad_send /ros/catkin_ws/src/pad_send
RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

# Now copy all the source code in to make sure everything is up to
# date. I'm fairly confident this will work but not 100% sure it won't
# rebuild everything ~~Alex
# RUN rm -rf /ros/catkin_ws/src
# COPY ros/catkin_ws/src /ros/catkin_ws/src
# RUN cd /ros/catkin_ws && /ros_entrypoint.sh catkin_make

# Add /catkin_ws to the ROS environment.
COPY ros/ros_entrypoint.sh /ros_entrypoint.sh
